<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Base64 Tool</title>
    <link th:href="@{/iview/iview.css}" rel="stylesheet"/>
    <script th:src="@{/libs/jquery-3.2.1.min.js}"></script>
    <script th:src="@{/libs/vue.min.js}"></script>
    <script th:src="@{/iview/iview.min.js}"></script>
    <style>
        .container {
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .text-area {
            margin: 10px 0;
            width: 100%;
        }
        .button-group {
            margin: 10px 0;
        }
        .copy-button {
            margin-top: 10px;
        }
        .mode-switch {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        .mode-switch span {
            margin-right: 10px;
        }
    </style>
</head>
<body>
<div id="app" class="container">
    <h2>Base64 Encoder/Decoder</h2>
    
    <div class="mode-switch">
        <span>Line Mode:</span>
        <i-switch v-model="lineMode" size="large">
            <span slot="open">ON</span>
            <span slot="close">OFF</span>
        </i-switch>
    </div>
    
    <i-input type="textarea" 
             v-model="inputText" 
             :rows="8"
             placeholder="Enter text to encode/decode" 
             class="text-area">
    </i-input>

    <div class="button-group">
        <i-button type="primary" @click="encode">
            <i class="fa fa-lock"></i> Encode
        </i-button>
        <i-button type="primary" @click="decode">
            <i class="fa fa-unlock"></i> Decode
        </i-button>
        <i-button type="warning" @click="clear">
            <i class="fa fa-trash"></i> Clear
        </i-button>
    </div>

    <i-input type="textarea" 
             v-model="outputText" 
             :rows="8"
             readonly
             placeholder="Output result" 
             class="text-area">
    </i-input>

    <i-button type="success" 
              @click="copyToClipboard" 
              class="copy-button"
              :disabled="!outputText">
        <i class="fa fa-copy"></i> Copy to clipboard
    </i-button>
</div>

<script>
new Vue({
    el: '#app',
    data: {
        inputText: '',
        outputText: '',
        lineMode: false
    },
    methods: {
        // Clear all input and output text
        clear() {
            this.inputText = '';
            this.outputText = '';
            this.$Notice.success({
                title: 'Success',
                desc: 'All content cleared'
            });
        },
        
        // 处理单行文本的编码
        encodeText(text) {
            return btoa(unescape(encodeURIComponent(text)));
        },
        
        // 处理单行文本的解码
        decodeText(text) {
            return decodeURIComponent(escape(atob(text)));
        },
        
        encode() {
            try {
                if (this.lineMode) {
                    // Process by line
                    const lines = this.inputText.split('\n');
                    const encodedLines = lines.map(line => {
                        return line.trim() ? this.encodeText(line) : '';
                    });
                    this.outputText = encodedLines.join('\n');
                } else {
                    // Process as whole
                    this.outputText = this.encodeText(this.inputText);
                }
                
                this.$Notice.success({
                    title: 'Success',
                    desc: 'Encoding completed'
                });
            } catch (e) {
                this.$Notice.error({
                    title: 'Error',
                    desc: 'Encoding failed: ' + e.message
                });
            }
        },
        
        decode() {
            try {
                if (this.lineMode) {
                    // Process by line
                    const lines = this.inputText.split('\n');
                    const decodedLines = lines.map(line => {
                        return line.trim() ? this.decodeText(line) : '';
                    });
                    this.outputText = decodedLines.join('\n');
                } else {
                    // Process as whole
                    this.outputText = this.decodeText(this.inputText);
                }
                
                this.$Notice.success({
                    title: 'Success',
                    desc: 'Decoding completed'
                });
            } catch (e) {
                this.$Notice.error({
                    title: 'Error',
                    desc: 'Decoding failed: ' + e.message
                });
            }
        },
        
        copyToClipboard() {
            navigator.clipboard.writeText(this.outputText).then(() => {
                this.$Notice.success({
                    title: 'Success',
                    desc: 'Copied to clipboard'
                });
            }).catch(err => {
                // Fallback solution
                const textarea = document.createElement('textarea');
                textarea.value = this.outputText;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    this.$Notice.success({
                        title: 'Success',
                        desc: 'Copied to clipboard'
                    });
                } catch (e) {
                    this.$Notice.error({
                        title: 'Error',
                        desc: 'Copy failed'
                    });
                }
                document.body.removeChild(textarea);
            });
        }
    }
});
</script>
</body>
</html> 