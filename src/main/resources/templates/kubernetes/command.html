<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Kubernetes Command Executor</title>
    <link th:href="@{/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/iview/iview.css}">
    <script th:src="@{/libs/jquery-3.2.1.min.js}" type="text/javascript"></script>
    <script th:src="@{/libs/vue.min.js}" type="text/javascript"></script>
    <script th:src="@{/iview/iview.min.js}" type="text/javascript"></script>
    <style>
        .command-container {
            margin: 20px;
            padding: 20px;
            max-width: 800px;  /* 限制容器宽度 */
        }
        .result-area {
            margin-top: 20px;
            min-height: 300px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
        }
        .button-group {
            margin-top: 15px;
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div id="app" class="command-container">
        <div class="form-group">
            <i-select v-model="selectedEnv" style="width: 200px" placeholder="Environment" @on-change="handleEnvChange">
                <i-option v-for="item in environments" :value="item.value" :key="item.value">{{ item.label }}</i-option>
            </i-select>
        </div>
        
        <div class="form-group">
            <i-input v-model="command" 
                    type="text" 
                    placeholder="Enter kubectl command (e.g. kubectl get pods -n default, kubectl delete pod pod-name -n namespace)"
                    @on-enter="executeCommand"></i-input>
        </div>
        
        <div class="button-group">
            <i-button type="primary" @click="executeCommand">Execute</i-button>
            <i-button type="default" @click="clearAll" style="margin-left: 8px">Clear</i-button>
        </div>
        
        <div class="form-group">
            <textarea class="form-control result-area" v-model="result" readonly></textarea>
        </div>
    </div>

    <script>
        var vm = new Vue({
            el: '#app',
            data: {
                environments: [],
                selectedEnv: '',
                command: '',
                result: ''
            },
            mounted() {
                this.loadEnvironments();
            },
            methods: {
                loadEnvironments() {
                    $.ajax({
                        url: "/system/env/visible?resourceType=K8S",
                        type: "GET",
                        success: (result) => {
                            if (result.success) {
                                this.environments = result.data.map(env => {
                                    return {
                                        value: env.name,
                                        label: env.name
                                    };
                                });
                                if (this.environments.length > 0) {
                                    this.selectedEnv = this.environments[0].value;
                                }
                            } else {
                                this.$Notice.error({
                                    desc: 'Failed to load environment options: ' + result.msg
                                });
                            }
                        },
                        error: (xhr) => {
                            this.$Notice.error({
                                desc: 'Failed to request environment options: ' + xhr.statusText
                            });
                        }
                    });
                },
                handleEnvChange(value) {
                    this.selectedEnv = value;
                },
                executeCommand() {
                    if (!this.selectedEnv) {
                        this.$Notice.warning({
                            desc: 'Please select environment first'
                        });
                        return;
                    }
                    if (!this.command) {
                        this.$Notice.warning({
                            desc: 'Please enter a command'
                        });
                        return;
                    }
                    
                    $.ajax({
                        url: '/api/kubernetes/execute-command',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            env: this.selectedEnv,
                            command: this.command
                        }),
                        success: (response) => {
                            this.result = response;
                        },
                        error: (xhr) => {
                            this.result = 'Error executing command: ' + xhr.responseText;
                        }
                    });
                },
                clearAll() {
                    this.command = '';
                    this.result = '';
                }
            }
        });
    </script>
</body>
</html> 